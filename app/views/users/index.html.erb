<%# app/views/users/index.html.erb %>

<div class="container py-4">
  <div class="card shadow-sm">
    <div class="card-header d-flex justify-content-between align-items-center">
      <h1 class="h3 card-title mb-0">Á§æÂì°‰∏ÄË¶ß</h1>
      <div>
        <% if policy(User).new? %>
          <%= link_to "Êñ∞Ë¶èÁ§æÂì°ÁôªÈå≤", new_user_path, class: "btn btn-primary" %>
        <% end %>
        <%= link_to "CSV„ÉÄ„Ç¶„É≥„É≠„Éº„Éâ",
            users_path(format: :csv,
                      q: params[:q]&.to_unsafe_h,
                      per_page: params[:per_page],
                      s: params[:s]),
            class: "btn btn-outline-secondary ms-2" %>
      </div>
    </div>
    <div class="card-body">
      <!-- üîç Ê§úÁ¥¢„Éï„Ç©„Éº„É†„ÇíËøΩÂä† -->
      <%= search_form_for @q, url: users_path, method: :get, html: { class: "row g-3 mb-4 align-items-end" } do |f| %>
        <div class="col-md-3">
          <%= f.label :name_cont, "ÂêçÂâç", class: "form-label" %>
          <%= f.search_field :name_cont, class: "form-control" %>
        </div>
        <div class="col-md-3">
          <%= f.label :furigana_cont, "„Åµ„Çä„Åå„Å™", class: "form-label" %>
          <%= f.search_field :furigana_cont, class: "form-control" %>
        </div>
        <div class="col-md-3">
          <%= f.label :department_eq, "ÈÉ®ÁΩ≤", class: "form-label" %>
          <%= f.select :department_eq, User::DEPARTMENTS, { include_blank: "ÊåáÂÆö„Å™„Åó" }, class: "form-select" %>
        </div>
        <div class="col-md-2">
          <%= label_tag :per_page, "‰ª∂Êï∞", class: "form-label" %>
          <%= select_tag :per_page,
                options_for_select([5, 10, 20, 50], params[:per_page] || 5),
                class: "form-select" %>
        </div>
        <div class="col-md-1 d-flex">
          <%= f.submit "Ê§úÁ¥¢", class: "btn btn-outline-primary me-2 flex-fill" %>
        </div>
      <% end %>


      <p class="text-muted">
        Ê§úÁ¥¢ÁµêÊûú: <%= @users.count %> ‰ª∂
      </p>

      <!-- üìã ‰∏ÄË¶ß„ÉÜ„Éº„Éñ„É´ -->
      <div class="table-responsive">
        <table class="table table-hover table-striped mt-3">
          <thead class="table-light">
            <tr>
              <th><%= sort_link(@q, :employee_number, "Á§æÂì°Áï™Âè∑") %></th>
              <th><%= sort_link(@q, :name, "ÂêçÂâç") %></th>
              <th><%= sort_link(@q, :furigana, "„Åµ„Çä„Åå„Å™") %></th>
              <th><%= sort_link(@q, :department, "ÈÉ®ÁΩ≤") %></th>
              <th><%= sort_link(@q, :phone_number, "ÈõªË©±Áï™Âè∑") %></th>
              <th><%= sort_link(@q, :email, "„É°„Éº„É´„Ç¢„Éâ„É¨„Çπ") %></th>
              <th class="text-center"><%= sort_link(@q, :administrator_flag, "ÁÆ°ÁêÜËÄÖ") %></th>
              <th class="text-center">„Ç¢„ÇØ„Ç∑„Éß„É≥</th>
            </tr>
          </thead>
          <tbody>
            <% @users.each do |user| %>
              <tr>
                <td><%= user.employee_number %></td>
                <td><%= user.name %></td>
                <td><%= user.furigana %></td>
                <td><%= user.department %></td>
                <td><%= user.phone_number %></td>
                <td><%= user.email %></td>
                <td class="text-center">
                  <% if user.administrator_flag %>
                    <span class="badge bg-success">„ÅØ„ÅÑ</span>
                  <% else %>
                    <span class="badge bg-secondary">„ÅÑ„ÅÑ„Åà</span>
                  <% end %>
                </td>
                <td class="text-center">
                  <div class="btn-group btn-group-sm" role="group">
                    <%= link_to "Ë©≥Á¥∞", user, class: "btn btn-info text-white" %>
                    <% if policy(user).edit? %>
                      <%= link_to "Á∑®ÈõÜ", edit_user_path(user), class: "btn btn-warning" %>
                    <% end %>
                    <% if policy(user).destroy? %>
                      <%= link_to "ÂâäÈô§", user, data: { turbo_method: :delete, turbo_confirm: "Êú¨ÂΩì„Å´#{user.name}„Åï„Çì„ÇíÂâäÈô§„Åó„Åæ„Åô„ÅãÔºü" }, class: "btn btn-danger" %>
                    <% end %>
                  </div>
                </td>
              </tr>
            <% end %>
          </tbody>
        </table>
      </div>
      <div class="d-flex justify-content-center mt-3">
        <%= paginate @users, theme: 'bootstrap-5', params: params.to_unsafe_h.slice("q", "per_page", "s") %>
      </div>
    </div>
  </div>
</div>
